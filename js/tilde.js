var tilde = {}
tilde.elements = [
	{
		n:"hot",
		i:"hot streaks across careers",
		a:"Public",
		d:'Dense, mobile-friendly visualization of 30,000 careers and their "hot streaks."',
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"https://nuitrcs.github.io/kellogg-insight-hot-streaks/",
		s:"https://github.com/nuitrcs/kellogg-insight-hot-streaks",
		x:"<a href='https://insight.kellogg.northwestern.edu/article/career-hot-streaks#video' target='_blank'>Original Article and Video</a> | <a href='https://twitter.com/Frankly_Data/status/1020049325127282694' target='_blank'>Project Explanation</a>",
		r:"https://www.nature.com/articles/s41586-018-0315-8",
		f:"Kellogg Insight, Data Viz Today Podcast, Kantar IIB 2018"
	},
	{
		n:"mass",
		i:"masses of dead stars",
		a:"Scientific",
		d:"Scientific tool for promotional, research, and pedagogical use by domain specialists.",
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"https://ligo.northwestern.edu/media/mass-plot/index.html",
		s:"https://github.com/frankelavsky/LIGO-Virgo-Mass-Plot",
		x:"<i>This tool was released to supplement LIGO-Virgo's Nobel Prize-winning gravitational-wave research.</i>",
		r:"https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.119.161101",
		f:"Nobel Lectureship Talk by Barry Barish, 8 research papers, 1 textbook, LIGO-Virgo Official Graphic, AAS Nova, Medium, Ars Technica, Gizmodo, NSF Vizzies Semi-Finalist, Kantar IIB 2018"
	},
	{
		n:"jobs",
		i:"job automation risk",
		a:"Public",
		d:"Mobile-friendly, visualization-as-interface tool for searching job automation risk.",
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"https://insight.kellogg.northwestern.edu/article/how-will-automation-affect-different-united-states-cities#job_automation_risk",
		s:"https://github.com/nuitrcs/kellogg_insight_automation",
		x:"",
		r:"http://rsif.royalsocietypublishing.org/content/15/139/20170946",
		f:"Kellogg Insight, Quartz (pending)"
	},
	{
		n:"city",
		i:"city automation impact",
		a:"Public",
		d:"Mobile-friendly map for searching city automation risk.",
		t:"D3.js, Leaflet.js, Mapbox, JavaScript, HTML/CSS",
		l:"https://insight.kellogg.northwestern.edu/article/how-will-automation-affect-different-united-states-cities#city_automation_risk",
		s:"https://github.com/nuitrcs/kellogg_insight_city_automation",
		x:"",
		r:"http://rsif.royalsocietypublishing.org/content/15/139/20170946",
		f:"Kellogg Insight, Quartz (pending)"
	},
	{
		n:"venn",
		i:"student trends",
		a:"C-Suite",
		d:"Visualization presentation showing the changing intersections of student demographics.",
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"https://nuitrcs.github.io/IR_Venn_Diagram/",
		s:"",
		x:"",
		r:"",
		f:""
	},
	{
		n:"seismic",
		i:"surface wave radiation",
		a:"Scientific",
		d:"Scientific tool for seismologists to study surface wave radiation patterns of earthquakes.",
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"http://ds.iris.edu/ds/products/surface-wave-radiation-patterns/tools/surface-wave-radiation-patterns",
		s:"",
		x:"",
		r:"",
		f:""
	},
	{
		n:"design",
		i:"design process",
		a:false,
		d:"I'm audience-focused (human centered) with emphasis on rapid iteration.",
		t:"Adobe Suite, Hand Sketching, Tableau, R",
		l:"",
		s:"",
		x:"<br>My process:<br><b>Understand</b><br>I learn who my audience (users), collaborators, and stakeholders are, what the purpose is, and where the context for the final product will be. When scoping projects, I also examine the time that I have and I set schedules for deliverables.<br><b>Sketch</b><br>Then I begin sketching! I sketch a lot. Sometimes on paper and sometimes on Illustrator with a tablet.<br><b>Analyze</b><br>After initial ideas are the right direction (determined by feedback), I dig into the data. I often have significant cleaning, munging, and preparation to do to prepare the data for its final form - whether a visual or a story. This stage always involves preliminary analysis (or <i>getting to know</i> the data).<br><b>Draft</b><br>The next stage I being to draft frames, layouts, and static models in R, Tableau, or Illustrator. I continue drafting in an iterative process (build, share, process feedback, repeat) until the style is defined (if not already) and the product is ready for development.<br><b>Develop</b><br>Last, I begin to develop - writing code that turns the data into something. The process here is also iterative, as I maintain open channels for feedback with my collaborators and bring in users to test.",
		r:"",
		f:""
	},
	{
		n:"research",
		i:"research figures",
		a:"Scientific",
		d:"I have worked extensively with research partners to develop high-fidelity publication figures.",
		t:"D3.js, R, Python, Tableau",
		l:"",
		s:"",
		x:"",
		r:"",
		f:""
	},
	{
		n:"politics",
		i:"political polarization",
		a:"Public",
		d:"An 8-hour challenge to visualize 50 years of congressional voting patterns.",
		t:"D3.js, SVG, JavaScript, HTML/CSS",
		l:"https://frankelavsky.github.io/political-polarization-challenge/",
		s:"https://github.com/frankelavsky/political-polarization-challenge",
		x:"",
		r:"ftp://k7moa.com/junkord/HANDSL01114A20_STAND_ALONE_30.DAT",
		f:""
	},
	{
		n:"tableau",
		i:"tableau wizardry",
		a:"Public",
		d:"I've worked on several projects in Tableau and often use it alongside Illustrator for early-stage drafts of visualizations and data-munging. But on some occasions I have also used Tableau to take projects to completion.",
		t:"Tableau",
		l:"",
		s:"",
		x:"",
		r:"",
		f:""
	},
	{
		n:"logos",
		i:"algorithmic logos",
		a:false,
		d:"On rare occasions clients have requested algorithmically generated logos, which I am happy to oblige.",
		t:"D3.js, Adobe Illustrator",
		l:"",
		s:"",
		x:"",
		r:"",
		f:""
	},
	{
		n:"about",
		i:"about me",
		a:'',
		d:"Am I a graphic designer? A web developer? A data scientist? Yes, a bit of all of those.",
		t:"",
		l:"",
		s:"",
		x:"But I <i>prefer</i> to think of myself as someone who crafts experiences and stories out of mundane things.<br><br>I value <b>empathy</b> above all things, and this is central to what I do: from thinking of my audience to what I do in my free time (I often work on my tabletop RPG - maps pictured above, in case you wondered). Empathy makes both work and play meaningful.<br><br><b>Top Tools</b>: D3.js and JavaScript<br><b>Favorite Framework</b>: Vue.js (used on this portfolio!)<br><b>Prototyping</b>: Tableau (for charts) or Adobe Suite otherwise<br><b>Favorite Backend</b>: Node.js, but Flask is nice too<br><b>Data Prep and Analysis</b>: R and sometimes Tableau, Excel, or SQL<br><b>Workshop Materials</b>: I have over 25 hours of materials across a range of topics I've given to graduate students, peers, and faculty, from <i>Advanced Web Animation</i> to <i>Intro to Visualization</i>.<br><br><b>Contact me</b>: frankelavsky@gmail.com<br>Thanks for visiting!",
		r:"",
		f:""
	}
]
tilde.draw = function(){
	var j = tilde.elements.length,
		i;
	d3.select("#svg").append("defs").attr("id","defs")
	for (i = 0; i < j; i++) {
		var item = tilde.elements[i]
		var rect = d3.select("#"+item.n+" rect")
		if (rect.node()){
			d3.select("#defs").append("pattern")
				.attr('id','pattern_'+item.n)
				.attr('patternContentUnits','objectBoundingBox')
				.attr('width','100%')
				.attr('height','100%')
				.attr('x',"0%")
				.attr('y',"0%")
				.append("image")
				.attr('width',1)
				.attr('height',1)
				.attr('preserveAspectRatio','none')
				.attr('href',"files/"+item.n+".PNG")
			rect
				.attr('id','rect_'+item.n)
				.attr('style','')
				.attr('fill','url(#pattern_'+item.n+')')
			var group = d3.select("#"+item.n)
			var overlay = group.append('rect')
				.attr('id','overlay_'+item.n)
				.attr('width',rect.attr('width'))
				.attr('height',rect.attr('height'))
				.attr('x',rect.attr('x'))
				.attr('y',rect.attr('y'))
				.attr('opacity',0)
				.attr('fill','black')
			var text = group.append('text')
				.attr('id','text_'+item.n)
				.attr('x',function(){
					var x = +rect.attr('x')
					var adj = rect.attr('width')/2
					return x+adj
				})
				.attr('y',function(){
					var y = +rect.attr('y')
					var adj = rect.attr('height')/2
					return y+adj
				})
				.attr('text-anchor','middle')
				.style('font-size','76px')
				.html(item.i)
				.attr('opacity','0')

			var size = 76;
			while (text.node().getBBox().width > +rect.attr('width')*.95) {
				size--
				text.style('font-size',size+'px')
			}
			text
				.append('tspan')
				.attr('x',function(){
					var x = +rect.attr('x')
					var adj = rect.attr('width')/2
					return x+adj
				})
				.attr('y',function(){
					var y = +rect.attr('y')
					var adj = rect.attr('height')/2
					adj += size
					return y+adj
				})
				.style('font-style','italic')
				.style('font-size',size*.75 + 'px')
				.html('click to see')
			var hoverpanel = group
				.append('a')
				.attr('href',function(){
					var id = this.parentNode.id
					return "/#description_"+id
				})
				.on('mouseenter',function(){
					var id = this.parentNode.id
					d3.selectAll("#rect_"+id+', #overlay_'+id)
						.transition('bubble')
						.duration(500)
						.attr('ry',function(){
							return d3.select(this).attr('height')/2
						})
						.attr('rx',function(){
							return d3.select(this).attr('width')/2
						})
					d3.select('#overlay_'+id)
						.transition('opacity')
						.duration(500)
						.attr('opacity',.7)
					d3.select('#text_'+id)
						.transition('opacity')
						.duration(500)
						.attr('opacity',1)
				})
				.on('mouseleave',function(){
					var id = this.parentNode.id
					d3.selectAll("#rect_"+id+', #overlay_'+id)
						.transition('bubble')
						.duration(500)
						.attr('ry',function(){
							return 0
						})
						.attr('rx',function(){
							return 0
						})
					d3.selectAll('#overlay_'+id+', #text_'+id)
						.transition('opacity')
						.duration(500)
						.attr('opacity',0)
				})
				.append('rect')
				.attr('id','hover_'+item.n)
				.attr('class','hover-panel')
				.attr('width',rect.attr('width'))
				.attr('height',rect.attr('height'))
				.attr('x',rect.attr('x'))
				.attr('y',rect.attr('y'))
				.attr('opacity',0)
		}		
	}
	var app = new Vue({
	  el: '#descriptions',
	  data: tilde.elements
	})
	d3.select("#description_about a")
		.attr('href','https://youtu.be/B-_oWGBlPaM?t=5m29s')
		.attr('target','_blank')
	tilde.circles()
} 
tilde.circles = function(input_rand) {
	var width = d3.select('#background rect').attr('width')
	var height = d3.select('#background rect').attr('height')
	var background = d3.select("#background")
	var filter = d3.select('#defs').append("filter")
		.attr("id","glow");

	filter.append("feGaussianBlur")
		.attr("stdDeviation","3.5")
		.attr("result","coloredBlur");

	var feMerge = filter.append("feMerge");
	feMerge.append("feMergeNode")
		.attr("in","coloredBlur");
	feMerge.append("feMergeNode")
		.attr("in","SourceGraphic")

	function drawCircle() {
		var rand = Math.random()
		var xrand = Math.random()
		var circle = background.append("g")
			.attr('transform',function(){
				return 'translate(' + width*xrand + ', -60)'
			})

		circle.append("circle")
	      	.attr("r", 8 + rand*rand*60)
	      	.style("fill", "DIMGRAY")
			.style("opacity", 0.4)
			.style('mix-blend-mode','screen')
			.attr('filter','url(#glow')

		circle.transition()
			.delay(150*Math.random())
			.duration(10)
			.on("end", function(){
				var newx;
				var newy;
				var newrand = Math.random();
				newy = height*2
				newx = width*xrand - (width*1.5)*newrand

				d3.select(this)
					.transition()
					.duration(40000*(1.5-rand))
					.ease(d3.easeSin)
					//.attr("cy", newy)
					//.attr("cx", newx)
					.attr('transform',function(){
						return 'translate(' + newx + ',' + newy +')'
					})
					.on('end',function(){
						d3.select(this).remove()
					})
			});
	}
	setInterval(drawCircle,150)
	// var i;
 //    for (i = 1; i < 200; i ++) {
 //    	var circle = background.append("circle")
	//       	.attr("r", 4 + Math.random()*20)
	//       	.style("fill", "silver")
	// 		.style("opacity", 0);
	// 	circle.transition()
	// 		.delay(50*i)
	// 		.duration(10)
	// 		.style("opacity", 0.7)
	// 		.attr("cy", 0)
	// 		.attr("cx", width*.95)
	// 		.on("end", move);
 //    };
}
window.onload = tilde.draw